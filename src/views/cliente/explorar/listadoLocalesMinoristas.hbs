<style>
    * {
        transition: 0.2s;
    }

    .card:hover .card-img-top {
        border-bottom: rgb(2, 184, 117) 18px solid;
    }

    .categoria-de-producto:hover .img-categoria-producto {
        transform: scale(1.3);
    }

    .hide {
        display: none;
    }
</style>

<div class="container mt-3">
    <h2>Explorar</h2>
    <nav class="mt-4 border-0">
        <div class="nav nav-tabs border-0" id="nav-tab" role="tablist">
            <a class="nav-item nav-link text-success active" id="nav-pedidos-tab"
                href="/cliente/explorar/listadoLocalesMinoristas" role="tab" aria-controls="nav-home"
                aria-selected="true">Minoristas</a>
            <a class="nav-item nav-link text-success" id="nav-buzon-tab"
                href="/cliente/explorar/listadoLocalesMayoristas" role="tab" aria-controls="nav-profile"
                aria-selected="false">
                Mayoristas </a>
        </div>
    </nav>
    <div class="tab-content" id="nav-tabContent">

        <div class="tab-pane fade active show pb-3" id="nav-content" role="tabpanel">
            <div class="card border-0 pt-3" style="background-color: rgb(250, 250, 250);">

                <div class="row">

                    <div class="col-12"><i class="fas fa-filter"></i> Filtrar por</div>
                    <div class="container-categorias col-12 mt-3 mb-5 pr-5 d-flex" style="overflow-x: auto;"
                        id="container-categorias">
                        {{#each rowsCategorias}}
                        <div class="categoria-de-producto" style="" id="{{pkIdCategoriaProducto}}">
                            <div class="flex-{grow|shrink}-0 card border-0 text-white ml-2 mr-2"
                                style="overflow:hidden; border-radius: 15px;cursor: pointer; width: 120px;height: 120px; flex-shrink: 0;background: rgb(195,238,190);background: linear-gradient(180deg, rgba(3,170,0,1) 17%, rgba(77,255,79,1) 76%);">
                                <img src="{{rutaImagen}}" class="img-categoria-producto"
                                    alt="{{descripcionCategoriaProducto}}" style="width: 100%; height: 100%;">
                            </div>
                            <div class="p-2" style="width: 120px;">
                                <small>{{descripcionCategoriaProducto}}</small>
                            </div>
                        </div>
                        {{else}}
                        Error grave
                        {{/each}}


                    </div>
                    <div class="spinner-border text-success cargando-categorias hide" id="cargando-categorias"
                        role="status">
                        <span class="sr-only">Cargando...</span>
                    </div>
                    <div class="container-productos row" id="container-productos">
                        {{#each rowsLocalesMinoristas}}
                        <div class="col-xs-12 col-md-6 col-lg-4 p-1 local" id="{{pkIdLocalComercial}}"
                            categorias="1-2-3">
                            <a href="/cliente/explorar/local/{{pkIdLocalComercial}}" class="card shadow text-dark"
                                style="border-radius: 0.8em;text-decoration:none; ">
                                <img src="{{rutaImagen}}" class="card-img-top" alt="..."
                                    style="border-radius: 0.8em; max-height: 400px;border-bottom: rgb(2, 184, 117) 8px solid;">
                                <div class="card-body">
                                    <b class="card-title">{{nombreLocal}}</b>
                                    <div class="row row-col-2 justify-content-between">
                                        <div class="text-success col">
                                            <i class="fas fa-truck"></i> ${{precioDomicilio}}
                                        </div>
                                        <div class="text-warning col">
                                            <i class="fas fa-star"></i> {{calificacionPromedio}} <small
                                                style="color:rgb(168, 168, 168); font-size:17px;"> <i
                                                    class="far fa-user"></i> {{calificacionContadorCliente}}</small>
                                        </div>
                                    </div>
                                    <div class="card-text"
                                        style="overflow-x: auto; max-height: 100px;min-height: 30px;">
                                        {{descripcionLocal}}
                                    </div>
                                    <div class="btn btn-light w-100 mt-2">Explorar <i class="fas fa-angle-right"></i>
                                    </div>
                                </div>
                            </a>
                        </div>
                        {{else}}
                        No hay locales creados.
                        {{/each}}
                    </div>


                </div>
            </div>
        </div>
    </div>

    <script>
        //variables del documento
        const arrayLocales = {{{jsonLocales}}};
        $("#container-categorias").on("click", ".categoria-de-producto", function () {
            const categoriaSeleccionada = $(this).attr("id");
            console.log("la categoria seleccionada es ", categoriaSeleccionada);
            const localesFiltrados = arrayLocales.filter(function (local) {
                let aceptado = false;
                const arrayCategorias = local.categorias.split("-");
                for (let index = 0; index < arrayCategorias.length; index++) {
                    if (arrayCategorias[index] == categoriaSeleccionada) {
                        aceptado = true;
                        break;
                    }

                }
                return aceptado;

            });

            $("#cargando-categorias").removeClass("hide");
            localesFiltrados.map(function (local) {
                let col=document.createElement("div");
                col.setAttribute("class","col-xs-12 col-md-6 col-lg-4 p-1 local");
                col.setAttribute("id",local.id);
                col.setAttribute("categorias",local.categorias);

                let acard=document.createElement("a");
                acard.setAttribute("href",local.ruta);
                acard.setAttribute("class","card shadow text-dark");
                acard.setAttribute("style","border-radius: 0.8em;text-decoration:none;");
                acard.setAttribute("href",local.ruta);

                let portada=document.createElement("img");
                portada.setAttribute("href",local.ruta);
                portada.setAttribute("src",local.portada);
                portada.setAttribute("class","card-img-top");
                portada.setAttribute("alt",local.nombre);
                portada.setAttribute("style","border-radius: 0.8em; max-height: 400px;border-bottom: rgb(2, 184, 117) 8px solid;");
                
                let cardBody=document.createElement("div");
                cardBody.setAttribute("class","card-body");

                let cardTitle=document.createElement("b");
                cardTitle.setAttribute("class","card-title");
                cardTitle.innerHTML=""+local.nombre;

                

                




            });
            $("#cargando-categorias").addClass("hide");

        })
    </script>
    {{>navegacionCliente}}